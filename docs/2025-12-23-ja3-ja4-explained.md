# JA3 与 JA4 TLS 指纹识别技术详解

## 1. 什么是 TLS 指纹识别？
TLS 指纹识别（TLS Fingerprinting）是一种通过分析客户端在 TLS 握手阶段发送的 `ClientHello` 消息来识别客户端身份的技术。即使客户端隐藏了 IP 地址或修改了 User-Agent，其底层的 TLS 实现（加密套件、扩展等）通常具有独特性，可以作为其身份的“指纹”。

---

## 2. JA3 (第一代标准)
JA3 由 Salesforce 的研究人员于 2017 年发布，是目前行业内最通用的 TLS 指纹算法。

### 工作原理
JA3 提取 `ClientHello` 中的 5 个核心字段：
1. **TLS Version**: 协议版本
2. **Cipher Suites**: 加密套件列表
3. **Extensions**: 扩展列表
4. **Elliptic Curves**: 支持的椭圆曲线
5. **Elliptic Curve Point Formats**: 曲线点格式

**计算流程**：
- 将上述 5 个字段的值按顺序排列，用 `,` 分隔，字段内部值用 `-` 分隔。
- 对生成的原始字符串进行 **MD5** 哈希。

**示例**：
- 原始串：`771,4865-4866-4867,0-10-11,23-24,0`
- JA3 Hash：`66918128f1b9b03303d77c6f2eefd128`

### 局限性
1. **易受混淆 (Cipher Stunting)**：现代浏览器（如 Chrome）和 Go 语言程序会随机打乱字段顺序。由于 MD5 对顺序敏感，这会导致同一个客户端生成不同的 JA3。
2. **不可读性**：MD5 哈希是不可逆的，无法直接从指纹判断客户端的具体特征。

---

## 3. JA4 (新一代标准)
JA4 是 JA4+ 套件的核心部分，发布于 2023 年，旨在解决 JA3 的缺陷。

### 核心改进
- **分段结构**：指纹分为三部分，前段具备极强的可读性。
- **抗混淆**：在计算哈希前，JA4 会对加密套件和扩展列表进行**排序**，从而抵御顺序随机化带来的逃逸。

### 指纹格式示例
`t13d1516h2-8da98d9260-a238e9a018`

**各部分含义**：
1. **第一部分 (可读段 - `t13d1516h2`)**:
   - `t13`: TLS 1.3 协议（TCP 传输）。
   - `d15`: 域名类型特征。
   - `16`: 加密套件数量。
   - `h2`: 支持 HTTP/2 (ALPN)。
2. **第二部分 (`8da98d9260`)**: 排序后的加密套件列表哈希（前 12 位）。
3. **第三部分 (`a238e9a018`)**: 排序后的扩展列表哈希（前 12 位）。

---

## 4. JA3 vs JA4 对比总结

| 特性 | JA3 | JA4 |
| :--- | :--- | :--- |
| **可读性** | 差 (全哈希) | 强 (分段可读) |
| **抗顺序随机化** | 弱 | 强 (自动排序) |
| **信息丰富度** | 仅 TLS 层 | 包含协议、ALPN、排序特征等 |
| **主要用途** | 传统的恶意软件识别 | 高级 Bot 检测、客户端画像 |

---

## 5. 结论
- **JA3** 胜在生态成熟，几乎所有安全设备（IDS/IPS/WAF）都支持。
- **JA4** 代表了未来的技术趋势，提供了更强的稳定性和可分析性。在进行深度流量分析或对抗高级爬虫时，推荐优先使用 JA4。
